# ASCII Horror Header provided by BUGSHADOW
Write-Host "⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⢀⣤⡴⣶⢻⣛⡿⣦⡶⣟⡶⠦⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠉⠀⠀⠴⢾⡷⣶⣴⡟⣟⢿⣲⢦⣤⡀⠀⠀⠀" -ForegroundColor DarkRed
Write-Host "⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⢠⣿⣎⡷⣽⣫⣽⣽⡷⠛⠉⢀⣀⣀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⣀⠀⠀⠈⠙⢾⣽⣻⢾⣱⢯⡞⣽⡆⠀⠀" -ForegroundColor DarkRed
Write-Host "⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⢀⠀⠀⠀⠀⠈⠉⠉⠉⠙⠛⠻⠿⣞⡷⣾⣻⢼⡭⣟⣻⠽⣶⡄⠀⠀⠀⠀⠀⠀⢀⣴⠟⠛⠛⢶⡀⠀⠀⠉⠿⣯⣟⡷⣻⡼⣳⣄⠀" -ForegroundColor DarkRed
Write-Host "⠀⠀⠀⢀⣀⡼⣿⣤⣿⠿⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠻⢧⣟⡿⣼⣻⡼⣻⢇⣧⠀⠀⠀⠀⠀⠀⡼⠀⠀⠀⠀⠀⢿⠄⠀⠀⠀⠸⣟⡿⣧⣻⣇⠿⣇" -ForegroundColor DarkRed
Write-Host "⠀⠀⢠⣿⣹⢷⡻⠊⢁⣠⣤⣀⠀⠀⠀⠀⠀⠀⠀⣠⠶⠛⠻⢶⡀⠀⠀⠉⠻⣷⢯⡷⣏⣟⠾⡽⣦⡀⠀⠀⠀⠀⣠⣴⣶⣶⣄⠀⠀⠀⠀⠀⠀⠈⢿⣳⢿⡼⣻⡽" -ForegroundColor DarkRed
Write-Host "⠀⣰⣟⣮⡿⠋⠀⠠⠋⠀⠀⠙⠆⠀⠀⠀⠀⠀⠘⠁⢀⣀⡀⠀⠛⠀⠀⠀⠀⠈⠻⣿⡽⣞⣻⡵⣯⠇⠀⠀⠀⣼⠟⠉⠀⠈⠹⣷⡄⠀⠀⠀⠀⠀⠀⢻⡿⣼⣣⢿" -ForegroundColor DarkRed
Write-Host "⠀⣟⣾⡝⠁⠀⠀⢀⡴⠟⠿⣦⠀⠀⠀⠀⠀⠀⢠⡾⠛⠛⠻⣷⡄⠀⠀⠀⠀⠀⠀⠙⣿⣽⣣⢟⡽⡆⠀⠀⣼⠏⠀⢀⣶⣄⠀⠘⣷⠀⠀⠀⠀⠀⠀⠀⢻⣷⣫⡿" -ForegroundColor DarkRed
Write-Host "⠸⣷⡞⠀⠀⠀⢀⡞⠀⣤⡀⠸⡇⠀⠀⠀⠀⢰⡟⠀⣠⣤⠀⠘⣿⡀⠀⠀⠀⠀⠀⠀⠘⣷⣻⢾⣽⠛⠀⢀⣿⠀⠀⣾⣿⣿⠀⠀⢹⡇⠀⠀⠀⠀⠀⠀⠀⢿⣽⠀" -ForegroundColor DarkRed
Write-Host "⠀⣿⠀⠀⠀⠀⣸⠁⢸⣿⡇⠀⣷⠀⠀⠀⠀⣿⠀⢠⣿⣿⡆⠀⢸⡇⠀⠀⠀⠀⠀⠀⠀⠸⣯⣿⡓⠀⠀⢸⣿⠀⠀⣿⣿⣿⡇⠀⢸⡇⠀⠀⠀⠀⠀⠀⠀⢸⠟⠀" -ForegroundColor DarkRed
Write-Host "⠀⡙⠀⠀⠀⠀⣿⠀⣿⣿⡇⠀⡏⠀⠀⠀⢰⣇⠀⢸⣿⣿⡇⠀⢸⡇⠀⠀⠀⠀⠀⠀⠀⠀⢻⡟⠀⠀⠀⠈⣿⠀⠀⣿⣿⣿⠀⠀⣸⡇⠀⠀⠀⠀⠀⠀⠀⠈⡀⠀" -ForegroundColor DarkRed
Write-Host "⠀⠁⠀⠀⠀⢠⣿⠀⠹⡟⢀⠼⢧⠀⣀⠎⠀⠈⡆⢸⣿⣿⠁⠀⣾⠃⠀⠀⠀⠀⠀⠀⠀⠀⠈⣀⣤⣤⣀⠀⢿⣆⠀⠘⢿⠏⠀⢠⣿⠁⠀⠀⠀⠀⠀⠀⠀⠀⡇⠀" -ForegroundColor DarkRed
Write-Host "⠀⠀⠀⠀⠤⡈⠿⣧⣀⣠⠃⠀⠀⡿⡿⠀⠀⢀⣇⠀⣛⢁⡀⣼⡏⠀⠀⠀⠀⠀⠀⠀⠀⠀⢈⣿⣳⣳⢯⣷⠈⢿⣆⡀⠀⠀⣠⣾⠃⠀⡀⢄⠀⠀⠀⠀⠀⠀⠁⠀" -ForegroundColor DarkRed
Write-Host "⠀⠀⠀⠀⢀⣥⡀⠈⠙⢻⠀⠀⠀⣿⠇⠀⠀⢸⠻⡎⠀⠀⢹⠏⠀⢠⠐⡄⠀⠀⠀⠀⠀⠀⢸⡷⣯⢷⣻⢾⡃⠀⠛⠽⣟⡿⠟⠁⠀⠠⢉⠆⠌⠀⠀⠀⠀⠀⠀⠀" -ForegroundColor DarkRed
Write-Host "⠀⠀⠀⠀⢽⣿⢿⣆⠀⠀⠀⠀⢸⢿⠀⠀⠀⡆⢰⠀⠀⢀⠇⠀⠀⠠⠙⠠⠁⠀⠀⠀⠀⠀⢸⣿⣽⣾⡽⠯⠀⠀⠀⠀⠀⠀⠀⢀⣤⣤⡆⠈⠀⠀⠀⠀⠀⠐⠀⠀" -ForegroundColor DarkRed
Write-Host "⠀⢰⠀⠀⠘⣿⡏⠻⣷⠇⠀⠀⡆⢸⠀⠀⢠⠁⡆⠀⠀⢸⣴⣿⣿⣷⡄⠁⠀⠀⠀⠀⠀⠀⡄⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⣀⣴⡿⣯⣟⣿⡆⠀⠀⠀⠀⠀⡌⠀⠀" -ForegroundColor DarkRed
Write-Host "⠀⠀⢆⠀⠀⢹⣷⣄⢈⠆⠀⠀⣷⠆⠀⠀⢸⡴⠀⠀⠀⣾⡟⠀⠀⣿⣇⠀⠀⠀⠀⠀⠀⣸⠀⠀⠀⠀⠀⠀⠀⣀⣠⣴⣾⣟⡯⠛⣷⣟⡿⠀⠀⠀⠀⠀⡰⠀⠀⠀" -ForegroundColor DarkRed
Write-Host "⠀⠀⠈⢄⠀⠀⠽⣿⡞⠀⠀⠀⠋⠁⠀⠀⡟⡇⠀⠀⠸⢠⠃⠀⢠⡯⠂⠀⠀⠀⠀⠀⣰⣿⡿⣿⣻⣟⡿⣿⢿⣟⠿⠟⠋⠁⢀⣴⡿⡿⠁⠀⠀⠀⠀⡠⠁⠀⠀⠀" -ForegroundColor DarkRed
Write-Host "⠀⠀⠀⠀⠣⣀⠀⢈⠇⠀⠀⠀⠀⠀⠀⠀⠒⠁⠀⠀⣷⠏⠀⠀⡎⠀⠀⠀⠀⠀⠀⠀⠀⠈⠉⠉⠉⠉⠉⠉⠁⠀⠀⠀⣀⣴⡿⣯⢟⠁⠀⠀⠀⠀⡰⠁⠀⠀⠀⠀" -ForegroundColor DarkRed
Write-Host "⠀⠀⠀⠀⠀⠀⠉⠁⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠛⠀⠀⠸⠀⠀⠀⠀⢀⣤⣿⣶⣤⣀⣀⠀⠀⠀⠀⣀⣀⣤⣴⣾⢿⣯⠟⠑⠀⠀⠀⠀⢀⠜⠀⠀⠀⠀⠀⠀" -ForegroundColor DarkRed
Write-Host "⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⢠⡇⠀⠀⠀⠀⠈⠙⢻⣷⣯⡟⣿⣿⣿⣿⣿⡟⣿⣽⣿⡞⠋⠁⠀⠀⠀⠀⠀⡔⠁⠀⠀⠀⠀⠀⠀⠀" -ForegroundColor DarkRed
Write-Host "⠀⠀⠀⠀⡇⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⡸⢀⠀⡀⠈⠀⠀⠀⠀⠈⠉⠙⠓⠛⠚⠳⠛⠛⠓⠉⠁⠀⠀⠀⠀⠀⢀⠠⠊⠀⠀⠀⠀⠀⠀⠀⠀⠀" -ForegroundColor DarkRed
Write-Host "⠀⠀⠀⠀⢳⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠰⠋⠁⠀⠈⠑⠤⢀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⣀⠤⠂⠁⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀" -ForegroundColor DarkRed
Write-Host "⠀⠀⠀⠀⠀⢣⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⢰⠇⠀⠀⠀⠀⠀⠀⠀⠉⠐⠒⠠⠄⠤⢀⣀⣀⡀⠠⠀⠄⠐⠂⠉⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀" -ForegroundColor DarkRed
Write-Host "⠀⠀⠀⠀⠀⠀⠑⢄⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⣠⠏⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀" -ForegroundColor DarkRed
Write-Host "⠀⠀⠀⠀⠀⠀⠀⠀⠙⠂⠤⣀⣀⣀⣀⣀⡠⠔⠊⠁⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀" -ForegroundColor DarkRed
Write-Host "Beware... The shadows of BUGSHADOW will haunt your failure... Hihihihi!" -ForegroundColor Magenta

# Credential Reset Tool for Cursor on Windows
# This script resets Cursor's system credentials without running the cursor-free-vip application
# It only modifies configuration files without executing external code

# Check for administrator privileges
$estAdmin = ([Security.Principal.WindowsPrincipal] [Security.Principal.WindowsIdentity]::GetCurrent()).IsInRole([Security.Principal.WindowsBuiltInRole]::Administrator)
if (-not $estAdmin) {
    Write-Host "This script requires administrator privileges to update the Windows registry." -ForegroundColor Red
    Write-Host "Please right-click on PowerShell and select 'Run as Administrator', then relaunch this script." -ForegroundColor Yellow
    Write-Host "Press any key to exit..."
    $host.UI.RawUI.ReadKey("NoEcho,IncludeKeyDown") | Out-Null
    exit
}

# Helper function to generate identifiers
function Generer-Identifiants {
    # Generate UUID for appareilId
    $appareilId = [guid]::NewGuid().ToString()
    
    # Generate machineIdentifiant (64 hexadecimal characters)
    $octetsAleatoires = New-Object byte[] 32
    $generateur = [System.Security.Cryptography.RandomNumberGenerator]::Create()
    $generateur.GetBytes($octetsAleatoires)
    $machineIdentifiant = -join ($octetsAleatoires | ForEach-Object { $_.ToString("x2") })
    
    # Generate macIdentifiantMachine (128 hexadecimal characters)
    $octetsAleatoiresLarge = New-Object byte[] 64
    $generateur.GetBytes($octetsAleatoiresLarge)
    $macIdentifiantMachine = -join ($octetsAleatoiresLarge | ForEach-Object { $_.ToString("x2") })
    
    # Generate ID_SQM (UUID with braces)
    $id_SQM = "{" + [guid]::NewGuid().ToString().ToUpper() + "}"
    
    return @{
        "appareilId" = $appareilId
        "machineIdentifiant" = $machineIdentifiant
        "macIdentifiantMachine" = $macIdentifiantMachine
        "id_SQM" = $id_SQM
    }
}

# Ensure Cursor is closed
$processusCursor = Get-Process -Name "Cursor" -ErrorAction SilentlyContinue
if ($processusCursor) {
    Write-Host "Cursor is currently running. Please close it before continuing." -ForegroundColor Yellow
    $reponse = Read-Host "Do you want to force close Cursor now? (Y/N)"
    if ($reponse -eq "O" -or $reponse -eq "o") {
        Stop-Process -Name "Cursor" -Force
        Start-Sleep -Seconds 2
    } else {
        Write-Host "Please close Cursor and relaunch this script." -ForegroundColor Red
        exit
    }
}

# Define file paths
$cheminDonnees = [Environment]::GetFolderPath("ApplicationData")
$cheminCursor = Join-Path -Path $cheminDonnees -ChildPath "Cursor"
$cheminIdentifiantMachine = Join-Path -Path $cheminCursor -ChildPath "machineId"
$cheminUtilisateur = Join-Path -Path $cheminCursor -ChildPath "User"
$cheminStockageGlobal = Join-Path -Path $cheminUtilisateur -ChildPath "globalStorage"
$cheminStockage = Join-Path -Path $cheminStockageGlobal -ChildPath "storage.json"
$cheminBaseDonnees = Join-Path -Path $cheminStockageGlobal -ChildPath "state.vscdb"

# Check if paths exist
if (-not (Test-Path -Path $cheminCursor)) {
    Write-Host "Cursor installation not found at: $cheminCursor" -ForegroundColor Red
    exit
}

Write-Host "=== Cursor Credential Reset Tool ===" -ForegroundColor Cyan
Write-Host "This script will reset your machine credentials for Cursor." -ForegroundColor Cyan
Write-Host "Cursor installation found at: $cheminCursor" -ForegroundColor Green

# Generate new identifiers
Write-Host "`nGenerating new identifiers..." -ForegroundColor Cyan
$nouveauxIds = Generer-Identifiants

# Display the new identifiers
Write-Host "`nNew identifiers generated:" -ForegroundColor Green
Write-Host "appareilId: $($nouveauxIds.appareilId)" -ForegroundColor Gray
Write-Host "machineIdentifiant: $($nouveauxIds.machineIdentifiant)" -ForegroundColor Gray
Write-Host "macIdentifiantMachine: $($nouveauxIds.macIdentifiantMachine)" -ForegroundColor Gray
Write-Host "id_SQM: $($nouveauxIds.id_SQM)" -ForegroundColor Gray

# 1. Update the machineId file
Write-Host "`n[1/4] Updating the machine identifier file..." -ForegroundColor Cyan
if (Test-Path -Path $cheminIdentifiantMachine) {
    Copy-Item -Path $cheminIdentifiantMachine -Destination "$cheminIdentifiantMachine.backup" -Force
    Write-Host "Backup created at: $cheminIdentifiantMachine.backup" -ForegroundColor Yellow
}
Set-Content -Path $cheminIdentifiantMachine -Value $nouveauxIds.appareilId -Force
Write-Host "Machine identifier file updated successfully" -ForegroundColor Green

# 2. Update storage.json
Write-Host "`n[2/4] Updating the storage file..." -ForegroundColor Cyan
if (Test-Path -Path $cheminStockage) {
    Copy-Item -Path $cheminStockage -Destination "$cheminStockage.backup" -Force
    Write-Host "Backup created at: $cheminStockage.backup" -ForegroundColor Yellow
    
    try {
        $contenuStockage = Get-Content -Path $cheminStockage -Raw | ConvertFrom-Json
        
        # Update or add required values
        # Check and set each property, creating it if it doesn’t exist
        if (-not (Get-Member -InputObject $contenuStockage -Name "telemetry.devDeviceId")) {
            Add-Member -InputObject $contenuStockage -NotePropertyName "telemetry.devDeviceId" -NotePropertyValue $nouveauxIds.appareilId
        } else {
            $contenuStockage."telemetry.devDeviceId" = $nouveauxIds.appareilId
        }

        if (-not (Get-Member -InputObject $contenuStockage -Name "telemetry.machineId")) {
            Add-Member -InputObject $contenuStockage -NotePropertyName "telemetry.machineId" -NotePropertyValue $nouveauxIds.machineIdentifiant
        } else {
            $contenuStockage."telemetry.machineId" = $nouveauxIds.machineIdentifiant
        }

        if (-not (Get-Member -InputObject $contenuStockage -Name "telemetry.macMachineId")) {
            Add-Member -InputObject $contenuStockage -NotePropertyName "telemetry.macMachineId" -NotePropertyValue $nouveauxIds.macIdentifiantMachine
        } else {
            $contenuStockage."telemetry.macMachineId" = $nouveauxIds.macIdentifiantMachine
        }

        if (-not (Get-Member -InputObject $contenuStockage -Name "telemetry.sqmId")) {
            Add-Member -InputObject $contenuStockage -NotePropertyName "telemetry.sqmId" -NotePropertyValue $nouveauxIds.id_SQM
        } else {
            $contenuStockage."telemetry.sqmId" = $nouveauxIds.id_SQM
        }

        if (-not (Get-Member -InputObject $contenuStockage -Name "storage.serviceMachineId")) {
            Add-Member -InputObject $contenuStockage -NotePropertyName "storage.serviceMachineId" -NotePropertyValue $nouveauxIds.appareilId
        } else {
            $contenuStockage."storage.serviceMachineId" = $nouveauxIds.appareilId
        }
        
        $contenuStockage | ConvertTo-Json -Depth 10 | Set-Content -Path $cheminStockage
        Write-Host "Storage file updated successfully" -ForegroundColor Green
    }
    catch {
        Write-Host "Error updating the storage file: $_" -ForegroundColor Red
        Write-Host "Skipping storage file update" -ForegroundColor Yellow
    }
}
else {
    Write-Host "Storage file not found at: $cheminStockage" -ForegroundColor Yellow
    Write-Host "Creating a new storage file..." -ForegroundColor Yellow
    
    $contenuStockage = @{
        "telemetry.devDeviceId" = $nouveauxIds.appareilId
        "telemetry.machineId" = $nouveauxIds.machineIdentifiant
        "telemetry.macMachineId" = $nouveauxIds.macIdentifiantMachine
        "telemetry.sqmId" = $nouveauxIds.id_SQM
        "storage.serviceMachineId" = $nouveauxIds.appareilId
    }
    
    New-Item -Path $cheminStockageGlobal -ItemType Directory -Force | Out-Null
    $contenuStockage | ConvertTo-Json -Depth 10 | Set-Content -Path $cheminStockage
    Write-Host "New storage file created successfully" -ForegroundColor Green
}

# 3. Update the SQLite database
Write-Host "`n[3/4] Updating the database..." -ForegroundColor Cyan

if (Test-Path -Path $cheminBaseDonnees) {
    Copy-Item -Path $cheminBaseDonnees -Destination "$cheminBaseDonnees.backup" -Force
    Write-Host "Backup created at: $cheminBaseDonnees.backup" -ForegroundColor Yellow
    
    # Create a temporary Python script
    $scriptPython = @"
import sqlite3
import os

chemin_bd = '$($cheminBaseDonnees.Replace('\', '\\'))'
print(f"Connecting to SQLite database at: {chemin_bd}")

conn = sqlite3.connect(chemin_bd)
curseur = conn.cursor()

# Create the table if it doesn’t exist
curseur.execute('''
    CREATE TABLE IF NOT EXISTS ItemTable (
        key TEXT PRIMARY KEY,
        value TEXT
    )
''')

# Values to update
cles_et_valeurs = [
    ('telemetry.devDeviceId', '$($nouveauxIds.appareilId)'),
    ('telemetry.macMachineId', '$($nouveauxIds.macIdentifiantMachine)'),
    ('telemetry.machineId', '$($nouveauxIds.machineIdentifiant)'),
    ('telemetry.sqmId', '$($nouveauxIds.id_SQM)'),
    ('storage.serviceMachineId', '$($nouveauxIds.appareilId)')
]

# Update each key
for cle, valeur in cles_et_valeurs:
    print(f"Updating {cle} with new value")
    curseur.execute('INSERT OR REPLACE INTO ItemTable (key, value) VALUES (?, ?)', (cle, valeur))

# Commit changes and close
conn.commit()
print("Changes committed to the database")
conn.close()
print("Database updated successfully!")
"@
            
    $cheminScriptPython = "$env:TEMP\mise_a_jour_cursor_sqlite.py"
    Set-Content -Path $cheminScriptPython -Value $scriptPython
    
    # Attempt to execute with Python
    try {
        Write-Host "Attempting to use Python to update the database..." -ForegroundColor Yellow
        $resultatPython = & python $cheminScriptPython
        Write-Host $resultatPython -ForegroundColor Gray
        Write-Host "Database updated with Python successfully" -ForegroundColor Green
    }
    catch {
        Write-Host "Python execution failed. The database could not be updated: $_" -ForegroundColor Red
        Write-Host "You may need to manually update the database or install Python." -ForegroundColor Yellow
    }
    
    # Cleanup
    if (Test-Path -Path $cheminScriptPython) {
        Remove-Item -Path $cheminScriptPython -Force
    }
}
else {
    Write-Host "Database not found at: $cheminBaseDonnees" -ForegroundColor Yellow
    Write-Host "This is normal if you haven’t used Cursor before." -ForegroundColor Yellow
}

# 4. Update the Windows Registry
Write-Host "`n[4/4] Updating the Machine GUID in the Windows Registry..." -ForegroundColor Cyan
try {
    $cheminRegistre = "HKLM:\SOFTWARE\Microsoft\Cryptography"
    $ancienGUID = (Get-ItemProperty -Path $cheminRegistre -Name "MachineGuid" -ErrorAction SilentlyContinue).MachineGuid
    
    if ($ancienGUID) {
        Write-Host "Existing Machine GUID found: $ancienGUID" -ForegroundColor Yellow
        # Create a backup in the registry
        New-ItemProperty -Path $cheminRegistre -Name "MachineGuid.backup" -Value $ancienGUID -PropertyType String -Force | Out-Null
        Write-Host "Backup created in the registry: MachineGuid.backup" -ForegroundColor Yellow
    }
    
    # Generate a new GUID for the registry (different from those used in Cursor)
    $nouveauGUIDMachine = [guid]::NewGuid().ToString()
    Set-ItemProperty -Path $cheminRegistre -Name "MachineGuid" -Value $nouveauGUIDMachine -Type String -Force
    Write-Host "Machine GUID in Windows Registry updated to: $nouveauGUIDMachine" -ForegroundColor Green
}
catch {
    Write-Host "Failed to update the Windows Registry: $_" -ForegroundColor Red
    Write-Host "This step requires administrator privileges." -ForegroundColor Yellow
}

# Completion
Write-Host "`n=== Reset Completed ===" -ForegroundColor Green
Write-Host "Cursor's machine credentials have been successfully reset." -ForegroundColor Green
Write-Host "`nOperations performed:" -ForegroundColor Cyan
Write-Host "1. Generated new unique identifiers" -ForegroundColor White
Write-Host "2. Updated the machine identifier file at: $cheminIdentifiantMachine" -ForegroundColor White
Write-Host "3. Updated the storage file at: $cheminStockage" -ForegroundColor White
Write-Host "4. Attempted to update the database at: $cheminBaseDonnees" -ForegroundColor White
Write-Host "5. Updated the Machine GUID in the Windows Registry" -ForegroundColor White

Write-Host "`nBackups created:" -ForegroundColor Cyan
if (Test-Path -Path "$cheminIdentifiantMachine.backup") { Write-Host "- $cheminIdentifiantMachine.backup" -ForegroundColor White }
if (Test-Path -Path "$cheminStockage.backup") { Write-Host "- $cheminStockage.backup" -ForegroundColor White }
if (Test-Path -Path "$cheminBaseDonnees.backup") { Write-Host "- $cheminBaseDonnees.backup" -ForegroundColor White }

Write-Host "`nNext steps:" -ForegroundColor Cyan
Write-Host "1. Launch Cursor and complete the initial setup" -ForegroundColor White
Write-Host "2. If you need to undo these changes, rename the backup files to their original names" -ForegroundColor White

Write-Host "`nPress any key to exit..."
$host.UI.RawUI.ReadKey("NoEcho,IncludeKeyDown") | Out-Null